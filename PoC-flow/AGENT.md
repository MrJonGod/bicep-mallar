# Agent Instructions for Azure Infrastructure Deployment

## Purpose
This file guides AI agents to generate proper `.bicepparam` files for Azure infrastructure deployment following SX naming standards.

## Required Questions

When a user wants to deploy this infrastructure, ask the following questions to gather all required parameters:

### 1. Customer Prefix (customerPrefix)
**Question**: "Vilket kundprefix ska användas? (t.ex. 'sx' för Solution Xperts, 'abg' för AB Gavlegårdarna, 'lejon' för Lejonfastigheter)"

**Validation**:
- Must be lowercase
- Keep it short (2-6 characters recommended)
- Should be a recognizable abbreviation of the customer name

**Examples**:
- `sx` - Solution Xperts
- `abg` - AB Gavlegårdarna
- `lejon` - Lejonfastigheter
- `telge` - Telge

### 2. Domain/Technical Area (domain)
**Question**: "Vilken domän eller teknisk area ska resurserna tillhöra? (t.ex. 'int' för integration, 'dataplatform', 'finance')"

**Validation**:
- Must be lowercase
- Use abbreviations when appropriate (e.g., 'int' instead of 'integration')
- Common values: `int`, `dataplatform`, `finance`, `shared`

**Examples**:
- `int` - Integration domain
- `dataplatform` - Data platform
- `finance` - Finance systems
- `shared` - Shared resources

### 3. Function (function)
**Question**: "Vilken funktion eller användningsområde har resurserna? (t.ex. 'demo', 'api', 'dynamics', 'stratsys')"

**Validation**:
- Must be lowercase
- Should describe the purpose or integration group
- Use specific names that clarify the resource purpose

**Examples**:
- `demo` - Demo/PoC environment
- `api` - API layer
- `dynamics` - Dynamics integrations
- `shared` - Shared infrastructure

### 4. Subfunction (subfunction) - OPTIONAL
**Question**: "Finns det någon subfunktion eller mer detaljerad kategorisering? (lämna tomt om inte tillämpligt)"

**Validation**:
- Must be lowercase
- Only use when additional categorization is needed
- Leave empty if not applicable

**Examples**:
- `msgbroker` - Message broker subfunction
- `dab` - Data API builder
- Empty string (most common for simple deployments)

### 5. Environment (environment)
**Question**: "Vilken miljö ska resurserna deployas till?"

**Options**:
- `d` - Development (dev)
- `t` - Test
- `q` or `s` - QA/Staging
- `p` - Production

**Validation**:
- Must be exactly one character: d, t, q, s, or p

### 6. Azure Region (location)
**Question**: "Vilken Azure-region ska användas för deployment?"

**Common options**:
- `swedencentral` - Sweden Central (SDCR)
- `swedensouth` - Sweden South (SDSR)
- `westeurope` - West Europe (WE)
- `northeurope` - North Europe (NE)

**Validation**:
- Must use full Azure region name (e.g., 'swedencentral', not 'sdcr')
- The Bicep template will automatically convert to region abbreviation for resource names

**Default**: `swedencentral`

## Naming Standard Reference

All resource naming follows the standard documented in `../Namnstandard.txt`.

### General Pattern
```
[kundprefix]-[domän/teknisk area]-[funktion]-([subfunktion])-([region])-[miljö]-[resurstyp]
```

### Storage Account Special Rules
Storage accounts have strict limitations:
- **Maximum 24 characters**
- **Lowercase only**
- **No hyphens or special characters**

Pattern for storage accounts:
```
[kundprefix][domän][funktion][subfunktion][miljö]st
```

**IMPORTANT**: When generating storage account names, calculate the total length:
- `customerPrefix` + `domain` + `function` + `subfunction` + `environment` + `st` must be ≤ 24 characters
- If the combination exceeds 24 characters, alert the user and suggest shorter values for domain or function

### Example Validation
For `customerPrefix=sx`, `domain=int`, `function=demo`, `subfunction=''`, `environment=d`:
- Storage name: `sxintdemodst` (11 characters) ✅ Valid
- Full resource names: `sx-int-demo-sdcr-d-appi` ✅ Valid

For `customerPrefix=lejon`, `domain=integration`, `function=dynamics`, `subfunction=msgbroker`, `environment=d`:
- Storage name: `lejonintegrationdynamicsmsgbrokerdst` (39 characters) ❌ Too long!
- Suggest: Use `int` instead of `integration`, or remove subfunction

## Output Generation

After gathering all parameters, generate a `.bicepparam` file with the following structure:

```bicep
using './main.bicep'

param customerPrefix = '<value>'
param domain = '<value>'
param function = '<value>'
param subfunction = '<value>'  // or empty string ''
param environment = '<value>'
param location = '<value>'
```

## Resource Group Naming

The resource group name is automatically generated by the Bicep template as:
```
[kundprefix]-[domän]-[funktion]-([subfunktion])-[miljö]-rg
```

This name is outputted by the template and should be used in the deployment commands.

## Validation Checklist

Before generating the `.bicepparam` file, verify:
- [ ] All required parameters are collected
- [ ] All values are lowercase
- [ ] Environment is one of: d, t, q, s, p
- [ ] Storage account name will be ≤ 24 characters
- [ ] Location is a valid Azure region name
- [ ] Customer prefix is recognizable and short

## Example Interaction

**Agent**: "Jag hjälper dig att sätta upp Azure-infrastruktur enligt SX:s namnstandard. Jag behöver ställa några frågor:"

**Agent**: "1. Vilket kundprefix ska användas? (t.ex. 'sx', 'abg', 'lejon')"
**User**: "sx"

**Agent**: "2. Vilken domän eller teknisk area ska resurserna tillhöra? (t.ex. 'int', 'dataplatform', 'finance')"
**User**: "int"

**Agent**: "3. Vilken funktion eller användningsområde har resurserna? (t.ex. 'demo', 'api', 'dynamics')"
**User**: "poctest"

**Agent**: "4. Finns det någon subfunktion? (lämna tomt om inte tillämpligt)"
**User**: ""

**Agent**: "5. Vilken miljö ska resurserna deployas till? (d/t/q/s/p)"
**User**: "d"

**Agent**: "6. Vilken Azure-region ska användas? (Default: swedencentral)"
**User**: "swedencentral"

**Agent**: "Perfekt! Jag genererar nu en `.bicepparam`-fil med dessa värden. Resurserna kommer att namnges enligt SX:s standard:
- Resursgrupp: `sx-int-poctest-d-rg`
- Storage Account: `sxintpoctestdst` (15 tecken, inom gränsen på 24)
- Application Insights: `sx-int-poctest-sdcr-d-appi`
- Log Analytics: `sx-int-poctest-sdcr-d-log`"
